import 'dart:math';

import 'package:e_sup_app/models/stud_material.dart';
import 'package:e_sup_app/providers/stud_materials.dart';
import 'package:e_sup_app/providers/users.dart';
import 'package:e_sup_app/widget/material_item.dart';
import 'package:e_sup_app/widget/my_appBar.dart';
import 'package:e_sup_app/widget/searchBar.dart';
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

import '../../utils/colors.dart';
import '../../widget/add_new_material.dart';
import '../widget/courseMaterial.dart';
import '../../widget/new_material.dart';
import '../screens/activity_screens/leaderboard_screen.dart';

class MaterialsScreen extends StatefulWidget {
  const MaterialsScreen({super.key});

  @override
  State<MaterialsScreen> createState() => _MaterialsScreenState();
}

class _MaterialsScreenState extends State<MaterialsScreen>
    with TickerProviderStateMixin {
  void _addNewMaterial(
    String mtId,
    String mtTitle,
    String mtAuthorSchool,
    String uid,
    int grade,
    String type,
    String dept,
    DateTime date,
    String fileUrl,
  ) {
    final newMaterial = StudMaterial(
      id: mtId,
      authorId: uid,
      date: date,
      dept: dept,
      fileType: type,
      grade: grade,
      title: mtTitle,
      fileUrl: fileUrl,
    );
    setState(() {
      Provider.of<StudMaterials>(context, listen: false)
          .addMaterial(newMaterial);
    });
  }

  void _startAddNewMaterial(BuildContext ctx, String sId, String uid) {
    showModalBottomSheet(
      context: ctx,
      builder: (_) {
        return GestureDetector(
          onTap: () {},
          child: AddNewMaterial(sId, uid),
          behavior: HitTestBehavior.opaque,
        );
      },
    );
  }

  @override
  Widget build(BuildContext context) {
    TabController _tabContoller = TabController(length: 2, vsync: this);
    final userDetail =
        Provider.of<UserProvider>(context, listen: false).getUser;
   
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(15.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.start,
            children: [
              MyAppBar(
                backArrow: false,
                title: "Cources",
                name: "",
              ),
              Container(
                alignment: Alignment.topLeft,
                decoration: BoxDecoration(
                  border: Border(
                    bottom: BorderSide(
                      width: 1.0,
                      color: appColor,
                    ),
                  ),
                ),
                child: TabBar(
                  padding: EdgeInsets.all(10),
                  controller: _tabContoller,
                  labelColor: appColor,
                  indicator: BoxDecoration(
                    color: Color.fromARGB(136, 255, 193, 7),
                  ),
                  tabs: [
                    Tab(
                      text: "LeadBoard",
                      icon: Icon(Icons.leaderboard_outlined),
                      //iconMargin: EdgeInsets.all(5),
                      //height: 10,
                    ),
                    Tab(
                      text: "FAQ",
                      icon: Icon(Icons.question_mark),
                    ),
                  ],
                ),
              ),
              Expanded(
                flex: 2,
                child: TabBarView(
                  controller: _tabContoller,
                  children: [
                    Courses(),
                    Icon(Icons.directions_transit),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
      floatingActionButtonLocation: FloatingActionButtonLocation.endFloat,
      floatingActionButton: FloatingActionButton(
        onPressed: () => _startAddNewMaterial(
          context,
          userDetail.sId,
          userDetail.uid,
        ),
        backgroundColor: Color.fromARGB(255, 243, 211, 115),
        child: Icon(
          Icons.add,
        ),
      ),
    );
  }
}
